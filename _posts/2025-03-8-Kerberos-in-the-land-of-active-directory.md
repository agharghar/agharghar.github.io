---
layout: post
title:  Kerberos in the land of active directory
description: Kerberos is the authentication protocol used in Windows environments, replacing Netlogon as the main method for user authentication on domain controllers...
permalink: /Kerberos-in-the-land-of-active-directory
date:   2025-03-08 
image:  '/assets/images/Kerberos/kerberos.png'
tags:   [Kerberos,Active Directory,Authentification]
toc: true
#featured: true
published: false
---

# Introduction 

In Windows environments, Kerberos is the primary authentication protocol, having replaced Netlogon as the main method for authenticating users on domain controllers since Windows 2000.

In this post, we’ll start by exploring the Windows authentication process, focusing on how user credentials are handled before diving into how Kerberos enables secure authentication in a domain environment.

We’ll then break down how Kerberos works, including how it generates encryption keys, issues authentication tickets, and protects user credentials. This will provide insight into how access control is managed—such as how authentication tickets are requested, verified, and used when accessing network resources.


# Authentication Process

While logging into a Windows computer, you see a screen prompting you to enter your username and password.

![LoginUI]({{site.baseurl}}/assets/images/Kerberos/LoginUI.png)
*LoginUI.exe*

This interface is generated by a process called **LogonUI.exe**, which is started by another process known as **Winlogon**.

As part of the authentication process, **Winlogon.exe** launches **LogonUI.exe** , which then loads a component called the **Credential Provider**. 

The **Credential Providers** is essentially the interface where you enter your username and password.

{:refdef: style="text-align: center;"}
![Cred Provider]({{site.baseurl}}/assets/images/Kerberos/CredProv.png)
*Credential Provider - Usrname/Password*
{: refdef}

**Credential Provider**: *These are components that Windows uses to collect login credentials (such as passwords, PINs, and smart cards) and securely transmit them for authentication.*

Windows includes built-in **Credentials Providers** for different authentication methods like passwords, PINs, smart cards, and biometrics. However, third-party providers, such as multi-factor authentication (MFA) solutions, can also be integrated.

To fully understand the **Logon Process**, we must also consider the **LSASS** (*Local Security Authority Subsystem Service*). **LSASS** is responsible for enforcing the system's security policy. It verifies users logging onto a Windows computer or server, manages password changes, and creates access tokens.

So when you enter your **username and password**, the **Credential Provider** retrieves these credentials and passes them to **LogonUI**. **LogonUI** then forwards them to **Winlogon**, which, in turn, hands them over to the **LSASS** process.

Once received, **LSASS** processes the credentials and delegates them to the appropriate **authentication package** (e.g., Kerberos or NTLM) to verify the user's identity and complete the authentication process.

**Authentication Packages** *are dynamic-link libraries (DLLs) that **LSASS** uses to process authentication requests. These packages define how credentials are validated and determine whether a user is granted access to the system.*

In summary, we can visualize the **Logon Process** as follows:


![Logon Process]({{site.baseurl}}/assets/images/Kerberos/Logon Process.png)
*Windows Logon Process*


In this process, a **domain logon** grants a user the necessary permissions to access both local and domain resources. For a domain logon to occur, the user must have an account in **Active Directory**. Additionally, the computer must have an account in the **Active Directory** domain and be physically connected to the network. Users must also possess the appropriate rights to log on to either a local computer or the domain. Information regarding the domain user account and group memberships is used to manage access to both domain and local resources.

In our case, we are interested in **Kerberos authentication** and how **Kerberos** works internally.